<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Venturelab-creativity : " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <script type="text/javascript" src="javascripts/vendors/d3/d3.v2.js"></script>

    <title>Venturelab-creativity</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <!--<a id="forkme_banner" href="https://github.com/jp-a/VentureLab-Creativity">View on GitHub</a>-->

          <h1 id="project_title">Venture Lab - Creativity Course - Hi5 Team</h1>
          <h2 id="project_tagline"></h2>

            <!--<section id="downloads">-->
              <!--<a class="zip_download_link" href="https://github.com/jp-a/VentureLab-Creativity/zipball/master">Download this project as a .zip file</a>-->
              <!--<a class="tar_download_link" href="https://github.com/jp-a/VentureLab-Creativity/tarball/master">Download this project as a tar.gz file</a>-->
            <!--</section>-->
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
        <section id="main_content" class="inner">
            <h3>Getting to know each others - what we all 'are', 'like' or 'have' in common:</h3>

            <div id="graph"/>

            <p><em>The layout is rendered dynamically. You can drag dots around...</em></p>

        </section>
    </div>


    <script type="text/javascript" charset="utf-8">
        var w = 960, h = 500;

        var labelDistance = 5;

        var vis = d3.select( "#graph" ).append( "svg:svg" ).attr( "width", w ).attr( "height", h );

        var nodes = [
            {
                label: 'Jean-Philippe'
                , type: 'person'
            },
            {
                label: 'Madan'
                , type: 'person'
            },
            {
                label: 'Faith'
                , type: 'person'
            },
            {
                label: 'Greg'
                , type: 'person'
            },
            { label: 'We like art' },
            { label: 'We have a car' },
            { label: 'We am married' },
            { label: 'We have a child' },
            { label: 'We like nature' },
            { label: 'We like travelling' },
            { label: 'We are spiritual' },
            { label: 'We like endless conversation about the meaning of life' },
            { label: 'We like nice food' },
            { label: 'We like wine' },
            { label: 'We like being creative' },
            { label: 'We like to be on time' }
        ];

        var labelAnchors = [];
        for(var i = 0; i < nodes.length; i++) {
            labelAnchors.push({
                node : nodes[ i ]
            });
            labelAnchors.push({
                node : nodes[ i ]
            });
        }

        // Labels
        var labelAnchorLinks = [];
        for(var i = 0; i < nodes.length; i++) {
            labelAnchorLinks.push({
                source : i * 2,
                target : i * 2 + 1,
                weight : 1
            });
        };

        // Links
        var links = [];
        for ( var s = 0; s < 4; s++ ) {
            for ( var t = 4; t < nodes.length; t++ ) {
                links.push( {
                    source: s,
                    target: t,
                    weight: 1
                } );
            }
        };


        var force = d3.layout
                .force()
                .size( [w, h] )
                .nodes( nodes )
                .links( links )
                .gravity( 1 )
                .linkDistance( 200 )
                .charge( -3000 )
                .linkStrength( function ( x ) {
                    return x.weight * 5
                } );


        force.start();

        var force2 = d3.layout
                .force()
                .nodes( labelAnchors )
                .links( labelAnchorLinks )
                .gravity( 0 )
                .linkDistance( 0 )
                .linkStrength( 8 )
                .charge( -100 )
                .size( [w, h] );
        force2.start();

        var link = vis.selectAll( "line.link" )
                .data( links )
                .enter()
                .append( "svg:line" )
                .attr( "class", "link" )
                .style( "stroke", "#CCC" );

        var node = vis.selectAll( "g.node" )
                .data( force.nodes() )
                .enter()
                .append( "svg:g" )
                .attr( "class", "node" );
        node.append( "svg:circle" )
                .attr( "r", function ( d, i ) {
                    if( d.type == 'person' )
                        return 10;
                    else
                        return 5;
                } )
                .style( "fill", function ( d, i ) {
                    if( d.type == 'person' )
                        return "deeppink";
                    else
                        return "#555";
                } )
                .style( "stroke", "#FFF" )
                .style( "stroke-width", 3 );
        node.call( force.drag );


        var anchorLink = vis.selectAll( "line.anchorLink" )
                .data( labelAnchorLinks )
                //.enter().append( "svg:line" ).attr( "class", "anchorLink" ).style( "stroke", "#999" );

        var anchorNode = vis.selectAll( "g.anchorNode" )
                .data( force2.nodes() )
                .enter()
                .append( "svg:g" )
                .attr( "class", "anchorNode" );
        anchorNode.append( "svg:circle" )
                .attr( "r", 0 )
                .style( "fill", "#FFF" );
        anchorNode.append( "svg:text" )
                .text(function ( d, i ) {
            return i % 2 == 0 ? "" : d.node.label
        } ).style( "fill", "#555" ).style( "font-family", "Arial" ).style( "font-size", 12 );

        var updateLink = function () {
            this.attr( "x1",function ( d ) {
                return d.source.x;
            } ).attr( "y1",function ( d ) {
                        return d.source.y;
                    } ).attr( "x2",function ( d ) {
                        return d.target.x;
                    } ).attr( "y2", function ( d ) {
                        return d.target.y;
                    } );

        }

        var updateNode = function () {
            this.attr( "transform", function ( d ) {
                return "translate(" + d.x + "," + d.y + ")";
            } );
        }


        force.on( "tick", function () {

            force2.start();

            node.call( updateNode );

            anchorNode.each( function ( d, i ) {
                if ( i % 2 == 0 ) {
                    d.x = d.node.x;
                    d.y = d.node.y;
                } else {
                    var b = this.childNodes[1].getBBox();

                    var diffX = d.x - d.node.x;
                    var diffY = d.y - d.node.y;

                    var dist = Math.sqrt( diffX * diffX + diffY * diffY );

                    var shiftX = b.width * (diffX - dist) / (dist * 2);
                    shiftX = Math.max( -b.width, Math.min( 0, shiftX ) );
                    var shiftY = 5;
                    this.childNodes[1].setAttribute( "transform", "translate(" + shiftX + "," + shiftY + ")" );
                }
            } );


            anchorNode.call( updateNode );

            link.call( updateLink );
            anchorLink.call( updateLink );

        } );

        </script>


    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Venture Lab - Creativity Course - by <a href="https://github.com/jp-a">Hi5</a> Team</p>
        <p>Source available on <a href="https://github.com/jp-a/VentureLab-Creativity/blob/gh-pages/index.html">GitHub</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
