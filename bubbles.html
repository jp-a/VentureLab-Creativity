
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <!--<script type="text/javascript" src="d3/d3.js"></script>-->
    <!--<script type="text/javascript" src="d3/d3.geom.js"></script>-->
    <!--<script type="text/javascript" src="d3/d3.layout.js"></script>-->
    <script type="text/javascript" src="javascripts/vendors/d3/d3.v2.js"></script>
    <!--<link type="text/css" rel="stylesheet" href="style.css"/>-->
    <style type="text/css">

        circle {
            stroke: #000;
            stroke-opacity: .5;
        }
        text {
            font: 10px sans-serif;
        }

    </style>
</head>
<body>
<div id="body">
</div>

<script type="text/javascript">

    var w = 960,
            h = 800;

    var color = d3.scale.category20c();

//    var nodes = d3.range( 200 ).map( function () {
//                return {radius: Math.random() * 12 + 4};
//            } ),
//    console.log( nodes[ 0 ] );

    var person_radius = 40;
    var node_radius = 40;
    var nodes = [
        {   label: ''
            , id: 'root'
            , type: 'root'
            , radius: 0
        },
        {   label: 'Jean-Philippe'
            , radius: person_radius
            , type: 'person'
            , id: 'jpa'
            , img: 'images/nodes/jpa.png'
        },
        {   label: 'Madan'
            , radius: person_radius
            , type: 'person'
            , id: 'madan'
            , img: 'images/nodes/madan.png'
        },
        {   label: 'Faith'
            , radius: person_radius
            , type: 'person'
            , id: 'faith'
            , img: 'images/nodes/faith.png'
        },
        {   label: 'Greg'
            , radius: person_radius
            , type: 'person'
            , id: 'greg'
            , img: 'images/nodes/greg.png'
        },
        { label: 'We like art',                 radius: node_radius, score: 4 },
        { label: 'We have a car',               radius: node_radius, score: 4 },
        { label: 'We are married',               radius: node_radius, score: 4 },
        { label: 'We have a child',             radius: node_radius, score: 4 },
        { label: 'We like nature',              radius: node_radius, score: 4 },
        { label: 'We like travelling',          radius: node_radius, score: 4 },
        { label: 'We are spiritual',            radius: node_radius, score: 4 },
        { label: 'We like long conversations',  radius: node_radius, score: 4 },
        { label: 'We like nice food',           radius: node_radius, score: 4 },
        { label: 'We like wine',                radius: node_radius, score: 4 },
        { label: 'We like being creative',      radius: node_radius, score: 4 },
        { label: 'We like to be on time',       radius: node_radius, score: 4 }
    ];

    var force = d3.layout.force()
            .gravity( 0.04 )
            .charge( function ( d, i ) {
                //return i ? 0 : -2000;
                if( d.type == 'root' ) return -3000;
                if( d.type == 'person' ) return 0;
                else {
                    return 0
                }

            } )
            .nodes( nodes )
            .size( [w, h] );

    var root = nodes[0];
    //root.radius = 0;
    root.fixed = true;

    force.start();

    var svg = d3.select( "#body" ).append( "svg:svg" )
            .attr( "width", w )
            .attr( "height", h );

    var node = svg.selectAll( "node" )
            .data( nodes.slice( 1 ) )
            .enter().append( "svg:g" );

    node.append( "svg:circle" )
            .attr( "r", function ( d ) {
                return d.radius - 2;
            } )
            .style( "fill", function ( d, i ) {
                //return color( i % 3 );
                return ( d.type == 'person' ) ? "pink" : color( i % 15 );
            } );

    node.append( "text" )
            .attr( "text-anchor", "middle" )
            .attr( "dy", ".3em" )
            .text( function ( d ) {
                return ( d.type == 'person' ) ? '' : d.label;
                //.substring( 0, node_radius / 3 );
            } );

    node.append( "svg:image" )
            .attr( "class", "circle-img" )
            .attr( "xlink:href", function ( d, i ) {
                return ( d.type == 'person' ) ? d.img : '';
            } )
            .attr( "x", function ( d, i ) {
                return ( d.type == 'person' ) ? '-30px' : '-8px';
            } )
            .attr( "y", function ( d, i ) {
                return ( d.type == 'person' ) ? '-30px' : '-8px';
            } )
            .attr( "width", function ( d, i ) {
                return ( d.type == 'person' ) ? (person_radius*2)-4 + 'px' : '16px';
            } )
            .attr( "height", function ( d, i ) {
                return ( d.type == 'person' ) ? (person_radius*2)-4 + 'px' : '16px';
            } );

    force.on( "tick", function ( e ) {
        var q = d3.geom.quadtree( nodes ),
                i = 0,
                n = nodes.length;

        while ( ++i < n ) {
            q.visit( collide( nodes[i] ) );
        }

        svg.selectAll( "circle" )
                .attr( "cx", function ( d ) {
                    return d.x;
                } )
                .attr( "cy", function ( d ) {
                    return d.y;
                } );
        svg.selectAll( "text" )
                .attr( "x", function ( d ) {
                    return d.x;
                } )
                .attr( "y", function ( d ) {
                    return d.y;
                } );
        svg.selectAll( "image" )
                .attr( "x", function ( d ) {
                    return d.x - person_radius+2;
                } )
                .attr( "y", function ( d ) {
                    return d.y - person_radius+2;
                } );
    } );

    svg.on( "mousemove", function () {
        var p1 = d3.svg.mouse( this );
        root.px = p1[0];
        root.py = p1[1];
        force.resume();
    } );

    function collide( node ) {
        var r = node.radius + 16,
                nx1 = node.x - r,
                nx2 = node.x + r,
                ny1 = node.y - r,
                ny2 = node.y + r;
        return function ( quad, x1, y1, x2, y2 ) {
            if ( quad.point && (quad.point !== node) ) {
                var x = node.x - quad.point.x,
                        y = node.y - quad.point.y,
                        l = Math.sqrt( x * x + y * y ),
                        r = node.radius + quad.point.radius;
                if ( l < r ) {
                    l = (l - r) / l * .5;
                    node.x -= x *= l;
                    node.y -= y *= l;
                    quad.point.x += x;
                    quad.point.y += y;
                }
            }
            return x1 > nx2
                    || x2 < nx1
                    || y1 > ny2
                    || y2 < ny1;
        };
    }

</script>
</body>
</html>
